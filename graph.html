<html>
<head>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
            <script src="https://openlayers.org/en/v4.6.5/build/ol.js" type="text/javascript"></script>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="http://resources/demos/style.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="//resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js" ></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>

    <script type="text/javascript" charset="utf-8">
        var jsonfile;
        $.get(
            "csvjson.json",
            {paramOne : 1, paramX : 'abc'},
            function(data) {
                jsonfile = (' ' + JSON.stringify(data)).slice(1);
                json = JSON.parse(jsonfile);
                google.charts.load('current', {'packages':['corechart']});
                google.charts.setOnLoadCallback(drawChart);
            }
        );
    </script>
    <script>
        function getOccurrencesByYears(lower, upper){
            let array = [];
            for(var i=0; i<json.length; i++){
                if(json[i]["Year"] >= lower && json[i]["Year"] <= upper){
                    var found = false;
                    for (var j = 0; j < array.length; j++){
                        if (array[j][0] === json[i]["Place"]){
                            found = true;
                            (array[j][1]) = (Number)(array[j][1]) + json[i]["Occurrences"];
                            break;
                        }
                    }
                    if (!found) {
                        array.push([json[i]["Place"], json[i]["Occurrences"]]);
                    }
                }
            }
            array.sort(function(a, b){
                if(a[1] < b[1])
                    return 1;
                if(a[1] > b[1])
                    return -1;
                else return 0;
            });
            var arrayLength = array.length;
            if (arrayLength < 10){
                return array.slice(0, arrayLength);
            }
            return array.slice(0,10)
        }

        function getOccurrencesAllYears(){
            let array = [];
            for(var i=0; i<json.length; i++){
                var found = false;
                for (var j = 0; j < array.length; j++){
                    if (array[j][0] === json[i]["Place"]){
                        found = true;
                        (array[j][1]) = (Number)(array[j][1]) + json[i]["Occurrences"];
                        break;
                    }
                }
                if (!found) {
                    array.push([json[i]["Place"], json[i]["Occurrences"]]);
                }
            }
            array.sort(function(a, b){
                if(a[1] < b[1])
                    return 1;
                if(a[1] > b[1])
                    return -1;
                else return 0;
            });
            return array.slice(0,10)
        }

        function drawChart() {
            var lower = 2008, upper = 2010;
            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'שם המקום');
            data.addColumn('number', 'כמות מופעים');
            var arr = getOccurrencesByYears(lower, upper);
            data.addRows(arr);

            // Set chart options
            var options = {'title': 'הערים הכי מוזכרות בשנים ' + lower + "-" + upper,
                'width':800,
                'height':600,
                'rtlTable': true};

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
</head>

<body>
<!--Div that will hold the pie chart-->
<div id="chart_div"></div>
</body>
</html>
